<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

    <%- include('partials/header') %>

    <h2>Current Orders</h2>

    <% const today = new Date(); today.setHours(0, 0, 0, 0); %>

    <% orders.forEach(order => {
        const orderDate = new Date(order.date);
        orderDate.setHours(0, 0, 0, 0);
        const isFuture = orderDate > today;
        const isToday = orderDate.getTime() === today.getTime();
    %>
        <section class="order-card">
            <p><strong>Date:</strong> <%= order.date.toDateString() %></p>
            <p><strong>Total:</strong> £<%= order.total %></p>
            <p><strong>Fast-Track Rides:</strong> <%= order.fastRides.join(", ") || "None" %></p>
    
            <% if (isFuture) { %>
                <form action="/orders/add-ride" method="POST">
                    <input type="hidden" name="orderId" value="<%= order._id %>">
                    <label for="ride">Add Fast-Track Ride:</label>
                    <select name="ride">
                        <% rides.forEach(ride => { %>
                            <option value="<%= ride.name %>"><%= ride.name %> (£<%= ride.cost %>)</option>
                        <% }) %>
                    </select>
                    <button type="submit">Add Ride</button>
                </form>
            <% } else if (isToday) { %>
                <form action="/orders/use" method="POST">
                    <input type="hidden" name="orderId" value="<%= order._id %>">
                    <button type="submit">Use Ticket</button>
                </form>
            <% } else { %>
                <p>This ticket is no longer valid.</p>
            <% } %>
        </section>
    <% }) %>
    
    
    <a href="/orders/history">View previous orders</a>

    <%- include('partials/footer') %>

</body>
</html>